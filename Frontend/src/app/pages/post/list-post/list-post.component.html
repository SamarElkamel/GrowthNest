<div class="post-list-container">
  <h2 class="section-title">📢 Growthnest</h2>

  <!-- Tag Filter -->
  <div class="filter-container">
    <label for="tagFilter">🔍 Filter by Tag:</label>
    <select id="tagFilter" [(ngModel)]="selectedTag" (change)="onTagChange()">
      <option value="">All</option>
      <option *ngFor="let tag of tags" [value]="tag">{{ tag }}</option>
    </select>
  </div>

  <!-- Posts -->
  <div *ngFor="let post of visiblePosts" class="post-card">
    <div class="post-header">
      <h3>{{ post.title }}</h3>
      <span class="tag">{{ post.tags }}</span>
    </div>
    <p class="post-content">{{ post.content }}</p>

    <!-- Media Display -->
    <div class="media-section" *ngIf="post.image || post.video">
      <img *ngIf="post.image"
           [src]="getMediaUrl(post.image)"
           alt="Post Image"
           class="post-media"
           (error)="handleImageError($event)" />

      <video *ngIf="post.video" controls class="post-media">
        <source [src]="getMediaUrl(post.video)" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>

    <div class="post-meta">
      <span>🕒 {{ post.createdAt | date:'short' }}</span>
      <div class="reactions">
        <button (click)="addReact(post.idp, 'LIKE')" class="reaction-btn like-btn">
          👍 {{ likesMap[post.idp] || 0 }}
        </button>
        <button (click)="addReact(post.idp, 'DISLIKE')" class="reaction-btn dislike-btn">
          👎 {{ dislikesMap[post.idp] || 0 }}
        </button>
      </div>
      <button (click)="toggleResponses(post.idp)" class="toggle-responses-btn">
        {{ showResponsesMap[post.idp] ? 'Hide Responses' : 'Show Responses' }} ({{ (responsesMap[post.idp] || []).length }})
      </button>

      <!-- Admin Actions -->
      <div class="admin-actions" *ngIf="post.validated">
        <button (click)="toggleEditForm(post.idp)" class="action-btn edit-btn">✏️ Edit</button>
        <button (click)="deletePost(post.idp)" class="action-btn delete-btn">🗑️ Delete</button>
      </div>
    </div>

    <!-- Post Edit Form -->
    <div class="edit-form" *ngIf="showEditFormMap[post.idp]">
      <div class="form-group">
        <label>Title</label>
        <input type="text" [(ngModel)]="editedPost[post.idp].title" class="form-control">
      </div>
      <div class="form-group">
        <label>Content</label>
        <textarea [(ngModel)]="editedPost[post.idp].content" class="form-control" rows="3"></textarea>
      </div>
      <div class="form-group">
        <label>Tags</label>
        <select [(ngModel)]="editedPost[post.idp].tags" class="form-control">
          <option *ngFor="let tag of tags" [value]="tag">{{ tag }}</option>
        </select>
      </div>
      <div class="form-actions">
        <button (click)="updatePost(post.idp)" class="save-btn">Save Changes</button>
        <button (click)="toggleEditForm(post.idp)" class="cancel-btn">Cancel</button>
      </div>
    </div>

    <!-- Responses -->
    <div class="response-section" *ngIf="showResponsesMap[post.idp]">
      <h4>Responses</h4>
      <div *ngFor="let response of responsesMap[post.idp] || []" class="response-item">
        <div class="response-header">
          <span class="user-name">{{ response.user?.fullName || 'Anonymous' }}</span>
          <span class="response-date">{{ response.createdAt | date:'short' }}</span>
        </div>

        <!-- ✅ Show edit mode or default display -->
        <div *ngIf="!showEditResponseMap[response.id]">
          <p class="response-content">{{ response.respons }}</p>
          <div class="response-actions">
            <button (click)="toggleEditResponse(response.id, response.respons)" class="edit-btn">change comment✏️</button>
            <button (click)="deleteResponse(response.id, post.idp)" class="delete-btn">delete comment🗑️</button>
          </div>
        </div>

        <!-- ✏️ Edit Mode -->
        <div *ngIf="showEditResponseMap[response.id]" class="edit-response-form">
          <textarea [(ngModel)]="editedResponse[response.id]" rows="2" class="form-control"></textarea>
          <button (click)="updateResponse(response.id, post.idp)" class="save-btn">Save</button>
          <button (click)="toggleEditResponse(response.id, '')" class="cancel-btn">Cancel</button>
        </div>
      </div>

      <!-- Add new response -->
      <div class="new-response">
        <textarea [(ngModel)]="newResponse[post.idp]" placeholder="Write your response..." rows="3"></textarea>
        <button (click)="submitResponse(post.idp)" class="submit-btn">Submit Response</button>
      </div>
    </div>
  </div>

  <!-- Load More -->
  <div class="load-more">
    <button (click)="loadMore()" *ngIf="visiblePosts.length < posts.length">
      🔽 Load More
    </button>
  </div>
</div>
